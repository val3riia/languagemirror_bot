#!/bin/bash

# –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ Language Mirror Bot
# –í—ã–ø–æ–ª–Ω—è–µ—Ç:
# 1. –ü—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
# 2. –û—Å—Ç–∞–Ω–æ–≤–∫—É –¥—Ä—É–≥–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞
# 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π launcher

# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
echo "====================================================="
echo "ü§ñ Language Mirror Bot - –°—Ç–∞–±–∏–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫"
echo "====================================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ TELEGRAM_TOKEN
if [ -z "$TELEGRAM_TOKEN" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
    echo "–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä:"
    echo "export TELEGRAM_TOKEN=your_token_here"
    exit 1
else
    echo "‚úÖ TELEGRAM_TOKEN –Ω–∞–π–¥–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenRouter API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
if [ -z "$OPENROUTER_API_KEY" ]; then
    echo "‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è OPENROUTER_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
    echo "–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤, –±–µ–∑ AI"
else
    echo "‚úÖ OpenRouter API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω"
fi

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä—É–≥–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞
echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞..."
pkill -f 'python.*language_mirror' || true
pkill -f 'python.*run_bot' || true
pkill -f 'python.*telebot' || true
sleep 2

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
echo "üöÄ –ó–∞–ø—É—Å–∫ Language Mirror Bot..."
echo "---------------------------------------------------"
python run_bot_stable.py

# –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"
    echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏—á–∏–Ω—ã"
    exit 1
fi